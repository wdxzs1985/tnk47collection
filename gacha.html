<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="bootstrap-3.0.1/css/bootstrap.min.css" rel="stylesheet">
<link href="fancybox/jquery.fancybox.css?v=2.1.4" rel="stylesheet" type="text/css" media="screen" />
<link href="selectize.js-0.8.2/css/selectize.bootstrap3.css" rel="stylesheet" type="text/css" media="screen" />
<link href="main/css/styles.css" rel="stylesheet">
<style>
#list > div {
    height: 200px;
}
</style>
</head>
<body>
<div class="navbar navbar-static-top navbar-inverse">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
              <span class="sr-only">天下统一</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" title="天下统一模拟抽卡">天下统一模拟抽卡</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
           <ul class="nav navbar-nav">
               <li class=""><a href="index.html">天下统一图鉴</a></li>
               <li class=""><a href="illust.html">天下统一卡面查看</a></li>
           </ul>
       </div>
    </div>
</div>
<div class="container">
<div id="filter-form" class="" role="form">
<div class="form-group col-sm-4">
    <label for="q_ssr">SSR数量</label>
    <input type="text" id="q_ssr" value="1" class="form-control input-quantity">
</div>
<div class="form-group col-sm-4" >
    <label for="q_ssr">SR数量</label>
    <input type="text" id="q_sr" value="1" class="form-control input-quantity">
</div>
<div class="form-group col-sm-4">
    <label for="q_ssr">HR数量</label>
    <input type="text" id="q_hr" value="10" class="form-control input-quantity">
</div>
<div class="form-group col-sm-4">
    <label for="q_ssr">R数量</label>
    <input type="text" id="q_r" value="100" class="form-control input-quantity">
</div>
<div class="form-group col-sm-4">
    <label for="q_ssr">HN数量</label>
    <input type="text" id="q_hn" value="0" class="form-control input-quantity">
</div>
<div class="form-group col-sm-4">
    <label for="q_ssr">N数量</label>
    <input type="text" id="q_n" value="0" class="form-control input-quantity">
</div>
<div class="form-group col-sm-10 col-sm-offset-1">
    <div class="btn-group btn-group-justified">
	    <a class="btn btn-default btn-times" data-times="1">1連</a>
	    <a class="btn btn-default btn-times" data-times="10">10連</a>
	    <a class="btn btn-default btn-times" data-times="20">20連</a>
	    <a class="btn btn-default btn-times" data-times="50">50連</a>
    </div>
</div>
</div>
<div id="list" class="row"></div>
</div>
<script type="text/javascript" src="jquery/jquery-1.9.1.js"></script>
<script type="text/javascript" src="bootstrap-3.0.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="fancybox/jquery.fancybox.js?v=2.1.4"></script>
<script type="text/javascript" src="selectize.js-0.8.2/js/standalone/selectize.min.js"></script>
<script type="text/javascript" src="tmpl/tmpl.min.js"></script>
<script type="text/javascript" src="card.json"></script>
<script type="text/javascript">
$(function(){
    var filterdata = {};

    var filter = function(list, prop, value){
        if(value == '') {
            return list.slice();
        }
        var filt = [];
        $.each(list, function(index, element){
            if(element[prop] == value) {
                filt.push(element);
            }
        });
        return filt;
    }

    var randomList = function(list){
        var tl = list.slice();
        var i = tl.length;
        while(i){
            var j = Math.floor(Math.random()*i);
            var t = tl[--i];
            tl[i] = tl[j];
            tl[j] = t;
        }
        return tl;
    };
    
    var refresh = function(render, times){
        var $list = $('#list').empty();
        
        var cardData = [];
        cardData[0] = randomList(filter(render, 'rarilites', 'SSR'));
        cardData[1] = randomList(filter(render, 'rarilites', 'SR'));
        cardData[2] = randomList(filter(render, 'rarilites', 'HR'));
        cardData[3] = randomList(filter(render, 'rarilites', 'R'));
        cardData[4] = randomList(filter(render, 'rarilites', 'HN'));
        cardData[5] = randomList(filter(render, 'rarilites', 'N'));

        var gachaList = [];
        $('.input-quantity').each(function(index, element){
        	var quantity = $(element).val();
        	var list = cardData[index];
        	for(var i = 0; i < quantity; i++) {
        		gachaList.push(list.pop());
        	}
        });

        var cardList = [];
        for(var i=0; i< times; i++) {
        	gachaList = randomList(gachaList);
        	cardList.push(gachaList.pop());
        }
        
        var html = tmpl('tmpl-listbody-item', {render: cardList});
        $list.append(html);
        
        $('.fancybox').fancybox();
    }
    
    $('.btn-times').click(function(){
        var times = $(this).data('times');
        refresh(cards.slice(), times);
    });
});
</script>
<script type="text/x-tmpl" id="tmpl-listbody-item">
{% for (var i=0; i<o.render.length; i++) { %}
<div class="col-sm-2">
    <div class="thumbnail fancybox" href="http://stat100.ameba.jp/tnk47/ratio20/illustrations/card/{%=o.render[i].ill[0]%}.jpg" data-fancybox-group="{%=o.render[i].name%}" title="{%=o.render[i].name%}">
        <img class="" src="http://stat100.ameba.jp/tnk47/ratio10/illustrations/card/thumb/{%=o.render[i].ill[0]%}_thumbCard.jpg" alt="">
        <div class="caption text-center">{%=o.render[i].name%}</div>
    </div>
</div>
{% } %}
</script>
</body>
</html>
